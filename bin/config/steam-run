#!/bin/bash

# Parse arguments
while [[ $# -gt 0 ]]; do
    key=$1
    case "$key" in
        -n|--native)
            native=1
            ;;
        -w|--wine)
            wine=1
            ;;
        -*)
            echo "Error: Unrecognised option ${key}." >&2
            ;;
        *)
            if [[ "$key" -lt 0 ]]; then
                echo "Error: Game ID must be non-negative integer." >&2
                exit 1
            elif [[ -n "$game_id" ]]; then
                echo "Error: Multiple game ID present." >&2
                exit 1
            else
                game_id=$key
            fi
            ;;
    esac
    shift
done

if [[ -z "$game_id" ]]; then
    echo "Error: No game ID." >&2
    exit 1
fi

steam_process_name="steam"
steam_desktop_file="steam.desktop"
steam_command="steam"

if [[ "$wine" -eq 1 ]] && [[ "$native" -eq 1 ]]; then
    echo "Error: Native and Wine options can't be used at the same time." >&2
    exit 1
elif [[ "$wine" -eq 1 ]]; then
    export WINEPREFIX=~/.wine/steam
    export FREETYPE_PROPERTIES="truetype:interpreter-version=35"
    steam_process_name="Steam.exe"
    steam_desktop_file="steam-wine.desktop"
    steam_command="wine start"
elif [[ "$native" -eq 1 ]]; then
    steam_process_name="steam"
    steam_desktop_file="steam-native.desktop"
    steam_command="steam-native"
fi

pgrep "$steam_process_name" &> /dev/null || gtk-launch "$steam_desktop_file"
$steam_command "steam://rungameid/${game_id}"

