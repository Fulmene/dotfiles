#!/bin/bash

# Use with xss-lock -l to differentiate between regular lock and sleep lock

message_lock="Exploring the power of freedom."
message_sleep="Productivity is overrated."

kill_locker() {
    cinnamon-screensaver-command -d
}

lock_inactive() {
    return [[ -n "$(cinnamon-screensaver-command -q | grep inactive)" ]]
}

trap kill_locker TERM INT

if [[ -e /dev/fd/${XSS_SLEEP_LOCK_FD:--1} ]]; then

    # Make screen locker not inherit sleep lock
    if lock_inactive; then
        cinnamon-screensaver-command -l -m "$message_sleep" {XSS_SLEEP_LOCK_FD}<&-
    fi

    # Wait until the screen is locked
    while lock_inactive; do
        sleep 0.1
    done

    # Release the sleep lock
    exec {XSS_SLEEP_LOCK_FD}<&-

else
    cinnamon-screensaver-command -l -m "$message_lock"
fi
